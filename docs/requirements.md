# PokerNow - アミューズメントポーカー向けリアルタイム稼働管理アプリ 要件定義書

## 要件定義の作成原則
- **「あったらいいな」は絶対に作らない**
- **拡張可能性のための余分な要素は一切追加しない**
- **将来の「もしかして」のための準備は禁止**
- **今、ここで必要な最小限の要素のみ**

---

## 1. プロジェクト概要

### 1.1 成果目標
案件応募用デモアプリとして、アミューズメントポーカー店舗向けの「リアルタイム稼働状況＋トーナメント管理」プロトタイプを開発し、技術力とUI/UXセンスを証明する。

### 1.2 成功指標

#### 定量的指標
- ユーザー側の主要画面（ログイン、店舗一覧、店舗詳細、QRスキャン、マイページ）が実装されていること
- 店舗管理側の主要画面（ダッシュボード、店舗設定、卓管理、トーナメント管理）が実装されていること
- スマホ・タブレット・PCで適切に表示されること（レスポンシブ）
- 画面遷移とインタラクションがスムーズに動作すること
- モックデータによるリアルタイム風の更新演出があること

#### 定性的指標
- 「この人に頼みたい」と思わせるプロフェッショナルなUI/UX
- 実際のポーカー店舗運営をイメージできるリアルなデモ
- 操作フローが直感的で説明不要
- モダンで洗練されたダークテーマデザイン
- 案件の要件を正確に理解していることが伝わる実装

---

## 2. システム全体像

### 2.1 主要機能一覧
- **リアルタイム稼働状況**: 店舗の着席人数・稼働卓数・混雑状況を一覧表示
- **QR着席システム**: QRコード読み取りによる卓への着席登録
- **トーナメント管理**: ストラクチャー設定、レベル自動進行、タイマー表示
- **店舗管理**: 卓管理、QRコード生成、プレイヤー退席操作

### 2.2 ユーザーロールと権限
- **ゲスト**: 店舗一覧・店舗詳細の閲覧のみ
- **プレイヤー**: 着席登録、自分の着席状況確認、店舗情報閲覧
- **店舗管理者**: 卓管理、トーナメント管理、プレイヤー退席操作、全機能アクセス

### 2.3 認証・認可要件
- **認証方式**: モック認証（デモ用、実際の認証処理なし）
- **セキュリティレベル**: デモ用最小限
- **管理機能**: ロール切り替えボタンで簡単にデモ可能

---

## 3. ページ詳細仕様

### 3.1 P-001: ログイン/登録

#### 目的
ユーザー認証画面を表示し、Apple/Google/電話番号ログインのUI実装力を証明する。

#### 主要機能
- Apple IDでログインボタン
- Googleでログインボタン
- 電話番号でログインボタン
- ポーカーネーム登録フォーム
- 表示設定（公開/伏字/非表示）選択

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 認証 | ソーシャルログイン | ボタンクリック | ログイン状態に遷移（モック） |
| 作成 | ポーカーネーム登録 | ネーム、表示設定 | プロフィール作成完了 |

#### 処理フロー
1. ログインボタンをクリック
2. （モック）認証成功として処理
3. 初回の場合はポーカーネーム登録画面へ
4. 登録済みの場合は店舗一覧へ遷移

#### データ構造（概念）
```yaml
Player:
  識別子: playerId（UUID）
  基本情報:
    - pokerName（必須）: ポーカーネーム
    - displaySetting（必須）: 公開/伏字/非表示
    - authProvider（必須）: apple/google/phone
  メタ情報:
    - createdAt: 作成日時
    - updatedAt: 更新日時
```

---

### 3.2 P-002: 店舗一覧

#### 目的
稼働中の店舗一覧と混雑状況をリアルタイムで表示し、プレイヤーが行き先を選べるようにする。

#### 主要機能
- 店舗カード一覧表示
- 現在着席人数表示
- 稼働卓数表示
- 混雑状況バッジ（空き/やや混雑/混雑）
- 店舗検索・フィルター

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | 店舗一覧取得 | なし | 店舗リスト（モックデータ） |
| 取得 | リアルタイム更新 | 自動 | 人数・混雑状況の更新 |

#### 処理フロー
1. 画面表示時に店舗一覧を取得
2. 定期的に稼働状況を更新（モック）
3. 店舗カードタップで詳細画面へ

#### データ構造（概念）
```yaml
Shop:
  識別子: shopId（UUID）
  基本情報:
    - name（必須）: 店舗名
    - address（必須）: 住所
    - imageUrl（任意）: 店舗画像
  稼働情報:
    - currentPlayers: 現在着席人数
    - activeTables: 稼働卓数
    - totalTables: 総卓数
    - congestionLevel: 混雑レベル（low/medium/high）
  メタ情報:
    - createdAt: 作成日時
    - updatedAt: 更新日時
```

---

### 3.3 P-003: 店舗詳細

#### 目的
店舗の詳細情報、本日のイベント、開催中トーナメントの状況を表示する。

#### 主要機能
- 店舗基本情報表示
- 卓ごとの着席状況表示
- 本日のイベント一覧
- 開催中トーナメント情報
  - 現在レベル
  - 残り時間（タイマー）
  - ブラインド情報
- 「着席する」ボタン（QRスキャン画面へ）

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | 店舗詳細取得 | shopId | 店舗情報、イベント、トーナメント |
| 取得 | トーナメント状況 | 自動更新 | レベル、残り時間 |

#### 処理フロー
1. 店舗詳細情報を取得
2. トーナメントタイマーをリアルタイム表示
3. 「着席する」タップでQRスキャン画面へ

#### データ構造（概念）
```yaml
Event:
  識別子: eventId（UUID）
  基本情報:
    - shopId（必須）: 店舗ID
    - title（必須）: イベント名
    - description（任意）: 説明
    - startTime（必須）: 開始時間
    - endTime（任意）: 終了時間
  メタ情報:
    - createdAt: 作成日時

Tournament:
  識別子: tournamentId（UUID）
  基本情報:
    - shopId（必須）: 店舗ID
    - name（必須）: トーナメント名
    - status（必須）: waiting/running/paused/break/finished
  進行情報:
    - currentLevel: 現在レベル
    - remainingSeconds: 残り秒数
    - structure: ストラクチャー配列
  メタ情報:
    - createdAt: 作成日時
    - startedAt: 開始日時
```

---

### 3.4 P-004: QRスキャン

#### 目的
卓に設置されたQRコードを読み取り、着席登録を行う。

#### 主要機能
- カメラ起動・QRコード読み取り
- 位置情報確認（店舗内かチェック）
- 着席確認ダイアログ
- 着席完了通知

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | カメラ起動 | 許可 | カメラプレビュー |
| 取得 | 位置情報 | 許可 | 現在地座標 |
| 作成 | 着席登録 | QRデータ、位置情報 | 着席完了 |

#### 処理フロー
1. カメラ起動許可を要求
2. QRコードをスキャン
3. 位置情報を取得（デモでは常に許可）
4. 着席確認ダイアログ表示
5. 着席完了、マイページへ遷移

#### データ構造（概念）
```yaml
Seating:
  識別子: seatingId（UUID）
  基本情報:
    - playerId（必須）: プレイヤーID
    - shopId（必須）: 店舗ID
    - tableId（必須）: 卓ID
    - seatNumber（任意）: 座席番号
  状態情報:
    - status（必須）: active/left
    - seatedAt（必須）: 着席日時
    - leftAt（任意）: 退席日時
```

---

### 3.5 P-005: マイページ

#### 目的
プレイヤーの現在の着席状況と履歴を表示する。

#### 主要機能
- 現在の着席状況表示
- 着席中の店舗・卓情報
- 退席ボタン
- プロフィール編集リンク

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | 着席状況取得 | playerId | 現在の着席情報 |
| 更新 | 退席処理 | seatingId | 退席完了 |

---

### 3.6 A-001: 管理ダッシュボード

#### 目的
店舗のリアルタイム着席状況を俯瞰表示し、運営効率化を支援する。

#### 主要機能
- 全卓の着席状況マップ表示
- 現在の総着席人数
- 稼働卓数/空き卓数
- 開催中トーナメント状況
- クイックアクションボタン

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | ダッシュボード情報 | shopId | 全卓状況、統計 |
| 取得 | リアルタイム更新 | 自動 | 着席状況の更新 |

---

### 3.7 A-002: 店舗設定

#### 目的
店舗基本情報と卓数の登録・編集を行う。

#### 主要機能
- 店舗名・住所・営業時間編集
- 卓数設定（Table 1〜N）
- 店舗画像アップロード（モック）
- 位置情報設定（着席制限用）

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | 店舗情報取得 | shopId | 店舗設定データ |
| 更新 | 店舗情報更新 | 各フィールド | 更新完了 |
| 作成 | 卓追加 | 卓名 | 新規卓作成 |

---

### 3.8 A-003: 卓管理

#### 目的
各卓のQRコード表示と退席操作を行う。

#### 主要機能
- 卓一覧表示
- 各卓のQRコード表示・ダウンロード
- 卓ごとの着席者一覧
- 個別退席ボタン
- 卓全員退席ボタン

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 取得 | 卓一覧取得 | shopId | 卓リスト、着席者 |
| 更新 | 個別退席 | seatingId | 退席完了 |
| 更新 | 卓全員退席 | tableId | 全員退席完了 |

#### データ構造（概念）
```yaml
Table:
  識別子: tableId（UUID）
  基本情報:
    - shopId（必須）: 店舗ID
    - name（必須）: 卓名（Table 1など）
    - qrCode（自動生成）: QRコードデータ
    - maxSeats（任意）: 最大座席数
  状態情報:
    - isActive（必須）: 稼働中かどうか
  メタ情報:
    - createdAt: 作成日時
```

---

### 3.9 A-004: トーナメント管理

#### 目的
トーナメントの作成、ストラクチャー設定、進行管理を行う。

#### 主要機能
- トーナメント新規作成
- ストラクチャー登録（レベル、ブラインド、アンティ、時間）
- テンプレート選択
- 開始/一時停止/ブレイク操作
- レベル自動進行
- 現在レベル・残り時間表示

#### 必要な操作
| 操作種別 | 操作内容 | 必要な入力 | 期待される出力 |
|---------|---------|-----------|---------------|
| 作成 | トーナメント作成 | 名前、ストラクチャー | 新規トーナメント |
| 更新 | 開始 | tournamentId | 進行開始 |
| 更新 | 一時停止 | tournamentId | 一時停止 |
| 更新 | ブレイク | tournamentId | ブレイク開始 |
| 更新 | レベル進行 | 自動 | 次レベルへ |

#### データ構造（概念）
```yaml
TournamentStructure:
  レベル情報:
    - level（必須）: レベル番号
    - smallBlind（必須）: スモールブラインド
    - bigBlind（必須）: ビッグブラインド
    - ante（任意）: アンティ
    - duration（必須）: 時間（分）
    - isBreak（必須）: ブレイクかどうか
```

---

## 4. データ設計概要

### 4.1 主要エンティティ

```yaml
Player:
  概要: ポーカープレイヤー（アプリユーザー）
  主要属性:
    - 認証情報（authProvider、authId）
    - プロフィール情報（pokerName、displaySetting）
  関連:
    - Seating（1対多）

Shop:
  概要: アミューズメントポーカー店舗
  主要属性:
    - 基本情報（name、address、location）
    - 営業情報（openTime、closeTime）
  関連:
    - Table（1対多）
    - Event（1対多）
    - Tournament（1対多）

Table:
  概要: ポーカー卓
  主要属性:
    - 卓情報（name、qrCode、maxSeats）
    - 状態（isActive）
  関連:
    - Shop（多対1）
    - Seating（1対多）

Seating:
  概要: 着席記録
  主要属性:
    - 着席情報（playerId、tableId、seatNumber）
    - 状態（status、seatedAt、leftAt）
  関連:
    - Player（多対1）
    - Table（多対1）

Tournament:
  概要: トーナメント
  主要属性:
    - 基本情報（name、status）
    - 進行情報（currentLevel、remainingSeconds、structure）
  関連:
    - Shop（多対1）

Event:
  概要: 店舗イベント
  主要属性:
    - イベント情報（title、description、startTime、endTime）
  関連:
    - Shop（多対1）
```

### 4.2 エンティティ関係図

```
Player ──── Seating ──── Table ──── Shop
                                      │
                                      ├── Event
                                      │
                                      └── Tournament
```

### 4.3 バリデーションルール

```yaml
pokerName:
  - ルール: 1〜20文字、英数字・日本語可
  - 理由: 表示時の視認性確保

displaySetting:
  - ルール: public/masked/hidden のいずれか
  - 理由: プライバシー設定の明確化

着席制限:
  - ルール: 1ユーザー1卓のみ
  - 理由: 複数卓への同時着席防止

位置制限:
  - ルール: 店舗から半径100m以内（デモでは無効化可）
  - 理由: 店舗外からの不正着席防止
```

---

## 5. 制約事項

### 外部API制限
- **なし**: フロントエンドのみのプロトタイプのため

### 技術的制約
- **QRスキャン**: HTTPS環境が必要（localhost または Vercelデプロイ）
- **位置情報**: ユーザーの許可が必要
- **カメラ**: ユーザーの許可が必要

---

## 5.1 セキュリティ要件

### 基本方針
本プロジェクトはデモ用プロトタイプのため、セキュリティ要件は最小限とする。

### プロジェクト固有の必須要件

**認証機能（モック）**:
- ✅ ログイン画面のUI表示
- ✅ ロール切り替え機能
- ❌ 実際の認証処理は不要

**その他の一般要件**:
- ✅ HTTPSの強制（Vercelデプロイ時）
- ✅ 入力値の基本的なバリデーション

---

### 運用要件：可用性とヘルスチェック

**デモ用のため省略**:
- ヘルスチェックエンドポイント不要
- グレースフルシャットダウン不要

---

## 6. 複合API処理（バックエンド内部処理）

**該当なし**: フロントエンドのみのプロトタイプのため、複合API処理は存在しない。

---

## 7. 技術スタック

```yaml
フロントエンド:
  - フレームワーク: React 18
  - 言語: TypeScript 5
  - UIライブラリ: MUI v6（ダークテーマ）
  - 状態管理: Zustand
  - ルーティング: React Router v6
  - ビルドツール: Vite 5
  - QRコード生成: react-qr-code
  - QRコード読取: html5-qrcode
  - アイコン: MUI Icons

バックエンド:
  - なし（モックデータで対応）

データベース:
  - なし（フロントエンドのみ）

インフラ:
  - ホスティング: Vercel（無料）
```

---

## 8. 必要な外部サービス・アカウント

### 必須サービス
| サービス名 | 用途 | 取得先 | 備考 |
|-----------|------|--------|------|
| Vercel | Webアプリホスティング | https://vercel.com | 無料プラン |

### オプションサービス
| サービス名 | 用途 | 取得先 | 備考 |
|-----------|------|--------|------|
| なし | - | - | - |

---

## 9. 今後の拡張予定

**原則**: 拡張予定があっても、必要最小限の実装のみを行う

（案件獲得後の拡張候補）
- バックエンド実装（Supabase/Firebase）
- 実際の認証機能（Apple/Google/電話番号）
- リアルタイム通信（WebSocket/Supabase Realtime）
- プッシュ通知
- 決済機能
- React Native/Flutterでのネイティブアプリ化

---

## 10. デザインコンセプト

```yaml
テーマ: ダークモード（ポーカー/カジノの高級感）

カラーパレット:
  - プライマリ: ゴールド系（#FFD700）
  - 背景: ダークグレー（#121212, #1E1E1E）
  - サーフェス: ダークグレー（#2D2D2D）
  - アクセント: グリーン（#2E7D32、フェルト風）
  - エラー: レッド（#D32F2F）
  - テキスト: ホワイト（#FFFFFF）、ライトグレー（#B0B0B0）

雰囲気:
  - 高級感のあるカジノ風
  - モダンでプロフェッショナル
  - 視認性の高いコントラスト

混雑度バッジ:
  - 空き: グリーン（#4CAF50）
  - やや混雑: イエロー（#FFC107）
  - 混雑: レッド（#F44336）
```
